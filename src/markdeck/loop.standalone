#!/bin/ash

CONFIG_FILE=/target/.meta/config.json

while true; do
    CONFIG=$(cat $CONFIG_FILE)
    standalone=$(echo "$CONFIG" | jq -r '.standalone')

    if [ -n "$standalone" ]; then
        touch /target/.meta/standalone_rendered
        /usr/local/bin/embed < /target/index.html > "/target/$standalone"
        [ /target/index.html -nt /target/.meta/standalone_rendered ] && continue
    fi
    inotifywait -qq /target/index.html
done
